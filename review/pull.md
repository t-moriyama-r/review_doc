# 作業の進め方・プルリク編

> [親記事:よくあるレビュー指摘点](../README.md)<br>
>   ┗[コード編1(初学者向け)](./code_1.md)<br>
>   ┗[コード編2](./code_2.md)<br>
>   ┗[イディオム編(頻出ロジック)](./idiom.md)<br>
>   ┗プルリク編←ここ<br>
>   ┗[React・フロント編](./react.md)<br>
>   ┗[レベル別Gitフロー](./git.md)<br>

> [!TIP]
> ゆーて僕も雑なんですけど、やっぱりレビュアーに優しいプルリク作ってくれるとそれだけで嬉しいです。
> やったら分かると思うんですけど、**普通にレビューってダルいです。** 感謝しましょう…。

例によって下に行くほど要求レベルが上がっていきます。ただ、正直**どれも当たり前にやるべきこと**だと思います。
案外こういうのって教えてもらうことがなくて、人のを見様見真似でやれって言われることが多いので、レビュー経験がない人だとできてない人はかなり多い印象です。(このページも僕の見様見真似の集合体です)

> [!NOTE]
> 【目次】<br>
> - [分からないところは聞いて欲しい](#分からないところは聞いて欲しい)<br>
> - [進捗確認させないホウレンソウ](#進捗確認させないホウレンソウ)<br>
> - [修正の根拠となったチケット・概要を載せる](#修正の根拠となったチケット概要を載せる)<br>
> - [動作確認URL・設計書リンクを載せる](#動作確認URL設計書リンクを載せる)<br>
> - [修正箇所・方針をわかりやすく伝える](#修正箇所方針をわかりやすく伝える)<br>
> - [意図が分かるプルリクを意識する](#意図が分かるプルリクを意識する)<br>
> - [ちゃんとプルリクを書く](#ちゃんとプルリクを書く)<br>

## 分からないところは聞いて欲しい
### 聞くタイミング

実装方法が不明な時は**早めに(すぐに)聞いて欲しい**です。
時間取ったら悪いかな～とか思う気持ちもわかりますが、**スケジュール遅延しても巻き取るのこっち**なので、そうなる前に時間短縮してもらった方がこっちとしては**余計な仕事増えないので**非常に嬉しいです。

心臓に毛が生えてるタイプじゃない方のための心象が良くなる聞き方としては、努力した跡が見えると心象は良いので、**「何を目的として」「何を試して」「どうダメだったか」** を添えるといいんじゃないかなと思います。まあ、単純にどう手をつけたらいいか分からなかったらその時点で聞いてくれてOKです。
正直レビュアー目線では、**同じことを2回指摘しさえしなければ全然OK**です。頑張る人は大好きです。

一応こっちも、進捗が見えなくて怖いなーと思ったら毎日pushさせて進捗を毎日確認したりとかもするんですが、結局確認するのもダルいので、理想は **「この人なら放っておいてもスケジュール通り進むし、やばそうならちゃんと理由を添えてアラート出してくれる人だな」** って思わせることです。自分が管理する側だと仮定してどういう人なら安心できるか逆算すれば済む話です。そうすればこっちでペース配分うまくしてる限りなんも言われんくなります。


僕はだいたい**1時間ぐらい格闘して先に進まなかったら聞いてくれ**ってお願いしてましたし(だいたい聞いてくれれば秒殺なパターンが9割なので)、そういうペースを前提として評価をしていました。
逆に、**進捗確認され始めると相当ヤバい奴扱いされている**ということなので、もうそうなったらそのプロジェクトで居心地良く過ごすのは難しいっすね。次回から頑張りましょうって感じです。

いや……こんなの当たり前のホウレンソウだと思ってるんですけど、こっちから聞かないとハマってるアラートを出してくれない人っているんで……。しかもそういう人認定されるとめちゃくちゃ評価下がるんで、何の得にもならないです……。

### エラーメッセージは必ず添える
よくあるのが、「エラーが出ました、どうすればいいですか？」という質問です。ただ、こういう聞き方をするとどういうエラー？って聞き返すしかないので困ります。
この世の中にはエラーなんて無限にありますし、想定してるエラーから想定外のエラーまで色々あります。だから、**「◯◯するとXXというエラーが出る」** っていう情報と、**エラーメッセージのスクショかコピー**を付け足してください。それだけで手がかりがある程度絞れます。

ぶっちゃけこれも当たり前のことだと思ってたんですけど、そうじゃない人結構いるので意識するといいです。正直、こういう質問を受ける側としては呆れます。自分がそれ言われてどういう気持ちになるか想像できないんですかね……。

### できてないことは、できてないと正直に言う(アラートは早めに)
過去に困ったパターンとして、もうちょっと頑張ればできそう…みたいな報告が上がってたので油断してたら、蓋を開けてみれば筆が進んでないみたいな状態。**マジかよ…** って慌てて作業を巻き取ったりするハメになります。
この業界、そういう**バケモンみたいなヤツ**が意外と居るんですよね。できないもんはできないでしょうがないので、**アラートは早めに出して下さい。** 頑張っても無理なもんは無理です。技術力云々より、**スケジュールの遅延は評価を最悪にします。**

## 進捗確認させないホウレンソウ

> [!NOTE]
> 進捗確認される時点で**評価が落ちてることが示唆**されます。進捗管理する側の気持ちに立った報告は意識すべき。

パフォーマンス悪そうな人が進捗確認を個別でされてるの、いろんなプロジェクトで見受けられます。僕はやる気ない日はサボってるの許して欲しいので自分が管理する側だったら、って逆算して行動してるので進捗確認とかされたことないんですけど。

プロジェクトで気持ちよく過ごすためには、とにかく**ヤバい奴認定されないのが大事**です。**目をつけられたら終わり**です。
逆に言うと**やることやってれば基本なんも言われない**のがこの業界のいいとこだと思ってます。

### Step1：プルリクでコードをいつでも見れる状態にする
まず最初に誰でもできるのはコレです。少なくとも**コードベースで証拠を残せる**ので。割と最初にこれを指導されることは多いと思います。どこで詰まってそうとか分かると思うので。

こっちは、**この人何やってるんだろう…って思ってプルリクを覗いたり**もします。まあほんとは詰まったらさっさと聞いて欲しいんですけど……

> [!TIP]
> この手は1年目とかプロジェクト参入直後とかでのみ許されます(指示されます)。
> 基本的にはコミットは意味*単位に分割*するのが望ましいです。後述するレビュー時に見せるプルリクも見やすく整形したいので。~~それができないとナメられるという側面もあります~~

### Step2：具体的に何が終わっているかを述べる
大体のプロジェクトでは朝会とかで進捗報告するので、その際に何ができてるかっていうのを報告するんですが、何％ぐらい終わったとかそういう報告ってぶっちゃけ言えないと思うので、**どういう箇所まで終わって残課題がコレ**、っていう具体を述べれば大体伝わります。し、詰まってる課題が何かわかれば助け舟は誰かしら出してもらえるかも知れません。

### Step3：見積もりを述べる(慣れてきたら)
慣れてきたらこれ。何もなければ◯◯日(の午前中/午後まで)に終わると思います、っていうスケジュール感を述べれば**安心されて放任される**と思います。もちろん、その見積もりが毎回テキトーだと話にならないんですけど、もし何かでハマったらアラート出して線をずらせばいいです。何なら1時間ぐらいハマった段階でアラート出しときゃいいんです。

とにかく**見積もりとズレそうになったら周知すればいい**んです。マジでそれだけで済む話です。

>[!TIP]
>意識しても難しいんですけど、**見積もりは長めに言うのがセオリー**です。最初からハマった時のバッファを積んでおけば、**遅延のイメージはつかない**です。(結局どっかでハマることの方が多いんで…)
>このへんの匙加減は本当に慣れと自信から計算するしかないんですが、作業が巻いて終わるという印象を持たせるだけで印象が良くなります。まあ、長めに取ってるなって思われないラインというのが難しいところですが……

## 修正の根拠となったチケット・概要を載せる
プロジェクトルールにもよると思うけど、ぶっちゃけ作業者寄りのレビュアーは仕様については**なんのこっちゃ？** って思いながら見てると思う。

特に、何かの議論の結果決まった仕様については、このチケットで議論しましたとか先に言っておけば済む話。なければ概要をしっかり書いたらOK。

## 動作確認URL・設計書リンクを載せる
あんまり自発的にやってる人見たことないんですけど、絶対やった方がいいと思います。
レビュアー視点でどの画面の修正とか言葉で伝わらない(というか自分の担当箇所以外のメニューとか知らんがなｗ)と思うというか実際思って**毎回どのページのことか設計書見て調べながらレビューしてた**ので、こういうの事前にやってくれるだけでもマメ感でます。
仕様についての設計書のリンクとかあるとよりベターです。探すのダルすぎてこれも貼れって言った記憶ありますが、自発的にやってくれるのがベストだと思います。

![参考画像](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/da0909fd-2ae3-4903-abb9-235aa37cc309.png)<br>
こういうレベルで十分

さっきテキトーに作ったもので実際だと概要とかもうちょっと書くんですが、最低限これぐらいやってくれるとレビュアーから取る時間は減るかなと思います。

ちなみに、**何回載せてって言ってもなかなかURL貼ってくれない人**とかいて、闇の深さを感じますね。

## 修正箇所・方針をわかりやすく伝える

修正しましたって一言で言われても、修正箇所を探すのは**やっぱ普通にダルい。**

コミットのURLを貼り付けるだけで差分へのリンクが生まれるので、この指摘はこのように修正しました、っていうのが一目でわかると嬉しい。あんまり細々したコミットがありすぎるとそれも大変かもなので、軽微な修正ならまとめてもいいけど。

ほんとはプルリク出す前もちゃんとコミット分けるべきっちゃそうなんですけど、自分がレビューする側だとあんま指摘前に各コミットは見ない感ある。まあ大きな意味を持つコミット2,3に分かれてるぐらいがちょうどいいかも。

### 例：修正箇所へのリンクを貼る
>[!WARNING]
>サンプルのプルリクが個人開発のものでコミットメッセージも超適当なので、後でもうちょっとわかりやすいのに差し替えたいですが暫定で……

![](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/image-20250124-051154.png)

例えばこういう指摘があったとする。~~個人開発で人に見せる気あんまないものなのでコミットメッセージがゴミですが……~~
指摘修正をして対応したことについてコメントを残してほしいのですが、どのように修正したかというのは見る側からすると**いちいち探すのダルいです。**

### Step1: コミットへのリンク

適切なコミット分けがされていれば、コミットへのリンクを貼るだけでOKです。

![](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/image-20250124-051820.png)

このコミットのリンク先のURLをそのまま貼ればOKです。すると、

![](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/image-20250124-051820.png)

![](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/image-20250124-051841.png)
 
![](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/image-20250124-051926.png)

このように、修正箇所の差分だけ抽出したメッセージにできるのでわかりやすいです。

### Step2: 修正箇所のハイライト
軽微すぎて横着して意味単位のコミットにしなかった場合とかあると思うんですが、レビュアーに探させるのはつらいです。実はこれ、修正箇所をハイライトできるんですね。

 ![](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/image-20250124-052159.png)
 
対象コミットのハイライトしたい行をドラッグしたり選択したりすると、選択ができる。この時点でアドレスバーが書き換わってるので、それをコピーして貼り付ければOK。

 ![](https://github.com/t-moriyama-r/review_doc/blob/e58dc471328d539df217fed5118869d53060d27e/image-20250124-052343.png)
 
これで、該当ファイルの29行目から36行目がハイライトされたリンクが生成されるので、レビュアーはそれを見るだけで、この修正がどのような意図を持ったものなのかというのを判断しやすくなる。少なくともコアになった部分の修正はこのように伝えることで、修正の意図が正しく伝わってるかどうかをレビューできるので大変助かります。**絶対やるべきだと思います。**

### 例：修正に対して、1つ1つレスをする

ぶっちゃけ「修正しました」という一言と「修正箇所へのリンク」があればいいです。印象操作とか雑談とかしたければ追加で文言ちょろっと書くこともありますけど。

![](https://github.com/t-moriyama-r/review_doc/blob/cc9a0959b7d50f24c4f5502bd60faccf3eecded2/101f7e4d-2722-4691-bf69-d6f43379d65e.png)

雰囲気としてはこんな感じ。まず、きちんと対応したつもりになっているというエビデンスになるし、対応漏れがあればレビュー依頼出す前にわかる。ちなみにこういう工夫をせずに実装・対応漏れは2回あるとコイツほんとめんどくせえなって感情になる。誰も幸せにならないから、ちゃんとやった方がいいと思います。工夫しても漏れるのならしょうがないけど……

最後にまとめて「修正しました」とだけ送る人いるんですけど、なんなんですかねあれ？
コメントたくさんついてるとダメなプルリクみたいに見えてプライドが傷つくんですかね？現場での評価って割とレビュアーがPMとかから聞かれて答えるものだと思うので、媚を売るならレビュアーに売っといた方がいいと思います。（？）

> [!TIP]
> コミットメッセージに接頭辞とか使うとデキる感演出できます。

## 意図が分かるプルリクを意識する
### デカいプルリクを作らない
まあ結果的にそうなっちゃうこともたまにあるんですが、誰がどう考えてもこれ人に見せるもんちゃうやろみたいなサイズのプルリクがあがってくることがある。見れるわけないです……。

![](https://github.com/t-moriyama-r/review_doc/blob/cc9a0959b7d50f24c4f5502bd60faccf3eecded2/image-20250129-002929.png)

これとかFiles changedが36とかめっちゃ嫌な予感しますね。プルリクの責務を分散できないか検討した方がいいと思います。
チケットがでかい単位になっちゃってるパターンでも、ここで分割した方がスムーズなので見て欲しいとか色々自発的に提案しても問題ないスコープって多々あると思います。

まあ自分の技術力・修正力に自信があるというか、↑で言いたいことが伝わるのなら敢えてデカいまま投げつけることは実際あるんですが(笑)、**Files changedが15を超え始める**と**このプルリクでけえな…** ってなります。

## コード全体の品質に責任を持つ(develop)

他の人のプルリク見て指摘入ってたので、これは僕自身も特に意識してないなーと思ったので自戒を込めてここに追記。
特にdevelopに対してマージする際は全体に対する影響を顧みて、何か全体に共有できそうな修正があれば自分に関係ない箇所でも適用するようなプルリクにすべき、です。

もちろん、レビュー前だとその方針が合っているのかどうか不安だと思うので、レビュアーにまず「◯◯という方針で修正したいんですが問題ないですかね？」と一言言えば済む話です。基本的なホウレンソウの話ですね。

### deprecateを活用する
既存のコードに手を加えるとなにかが壊れる気がするが、機能として廃止の方向に持っていきたい…という時は、deprecateアノテーションをつけて廃止予定であることを伝えましょう。

## ちゃんとプルリクを書く

> [!NOTE]
> 若干カッコつけたい人向けみたいなところありますが、レビュアー目線だと超わかりやすい。

「ちゃんと」っていうのがどのレベルなのかという話はありますが、「概要」「何故やったか」「(バグならば)原因」「解決方法(プルリクの内容)」などをちゃんとマークアップし整形したプルリクを作ると見栄えがとても良いです。
かなーりデキる人はちゃんとやってるイメージですけど、まあ別にマストじゃないしやんなくてもいいかな感あるけど、ヒマな時は意識してもいいかなと思ったので自戒も込めてここに書く。
(具体例は余力あったら書きます……ある程度色んなプルリク見た人だと言わんとしてることわかると思う)
